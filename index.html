<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>DomainSafePro - Setup Your Protection</title>
  <meta name="description" content="Set up email authentication for your domain. Get your DNS records and verify your protection status."/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Vollkorn:wght@600&family=Exo+2:wght@600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://rsms.me/">
  <link rel="stylesheet" href="https://rsms.me/inter/inter.css">

  <style>
/* ========== TOKENS (matching landing page) ========== */
:root {
  --font-serif: 'Vollkorn', Georgia, serif;
  --font-sans: 'Inter', ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  --font-brand: 'Exo 2', sans-serif;
  --font-mono: 'Roboto Mono', 'Fira Code', ui-monospace, monospace;
  --radius: 14px;
  --radius-sm: 8px;
  --maxw: 1100px;
  --fast-transition: 0.15s ease;
  --med-transition: 0.3s ease;
}

[data-theme="dark"] {
  --bg: #0c0c0e;
  --bg-card: #141417;
  --bg-alt: #1a1a1d;
  --bg-input: rgba(0,0,0,0.25);
  --fg: #ededf0;
  --fg-muted: #9496a3;
  --border: rgba(255,255,255,0.1);
  --border-glow: rgba(255,255,255,0.2);
  --brand: #5a81ff;
  --brand-accent: #8a7aff;
  --warn: #ffd36a;
  --ok: #67e8a3;
  --danger: #ff7a7a;
  --shadow-color: rgba(0,0,0,0.3);
  --glass-bg: rgba(20,20,23,0.55);
  --glass-border: rgba(255,255,255,0.12);
  --highlight-bg: rgba(90,129,255,0.08);
  --highlight-border: rgba(90,129,255,0.3);
}

[data-theme="light"] {
  --bg: #fafafa;
  --bg-card: #ffffff;
  --bg-alt: #f5f5f5;
  --bg-input: rgba(0,0,0,0.04);
  --fg: #111113;
  --fg-muted: #55555c;
  --border: rgba(0,0,0,0.1);
  --border-glow: rgba(0,0,0,0.2);
  --brand: #4a75ff;
  --brand-accent: #7a6aff;
  --warn: #f5a623;
  --ok: #28a745;
  --danger: #d9534f;
  --shadow-color: rgba(0,0,0,0.08);
  --glass-bg: rgba(255,255,255,0.6);
  --glass-border: rgba(0,0,0,0.08);
  --highlight-bg: rgba(74,117,255,0.06);
  --highlight-border: rgba(74,117,255,0.25);
}

/* ========== BASE ========== */
* { box-sizing: border-box; }
html { scroll-behavior: smooth; font-feature-settings: 'liga' 1, 'kern' 1; }
html, body { max-width: 100%; overflow-x: clip; }
body {
  margin: 0;
  min-height: 100vh;
  background: linear-gradient(135deg, var(--bg) 0%, var(--bg-alt) 50%, var(--bg) 100%);
  color: var(--fg);
  font-family: var(--font-sans);
  font-size: 17px;
  line-height: 1.7;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  transition: background-color var(--med-transition), color var(--med-transition);
}
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 1000px;
  height: 1000px;
  background: radial-gradient(circle, rgba(90,129,255,0.06) 0%, transparent 70%);
  pointer-events: none;
  z-index: 0;
}

h1, h2, h3, h4 {
  font-family: var(--font-serif);
  color: var(--fg);
  font-weight: 600;
  letter-spacing: -0.01em;
  line-height: 1.3;
  margin: 0;
}
p { color: var(--fg-muted); margin: 0; max-width: 65ch; }
a { text-decoration: none; color: var(--brand); }
code, .mono { font-family: var(--font-mono); font-size: 0.9em; }

/* ========== HEADER ========== */
header {
  position: sticky;
  top: 0;
  z-index: 100;
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  background: var(--glass-bg);
  border-bottom: 1px solid var(--glass-border);
  padding: 16px 20px;
}
.header-inner {
  max-width: var(--maxw);
  margin: 0 auto;
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 12px;
}
.brand {
  display: flex;
  align-items: center;
  gap: 12px;
  font-weight: 700;
  font-size: 1.4rem;
  color: var(--fg);
  text-decoration: none;
}
.brand:hover {
  opacity: 0.9;
}
.brand-text {
  font-family: var(--font-brand);
  background: linear-gradient(90deg, #5a81ff 0%, #21E6C1 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.header-tag {
  font-size: 13px;
  color: var(--fg-muted);
  display: none;
}
@media (min-width: 768px) {
  .header-tag { display: block; max-width: 400px; }
}

.auth-bar {
  display: flex;
  gap: 10px;
  align-items: center;
  flex-wrap: wrap;
}
#auth-status-label {
  font-size: 13px;
  color: var(--fg-muted);
}

/* Theme toggle */
.theme-toggle {
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--bg-card);
  border: 1px solid var(--border);
  width: 36px;
  height: 36px;
  border-radius: 50%;
  cursor: pointer;
  transition: all var(--fast-transition);
}
.theme-toggle:hover { border-color: var(--border-glow); }
.theme-toggle svg { width: 16px; height: 16px; color: var(--fg-muted); }
[data-theme="dark"] .theme-toggle .sun-icon { display: block; }
[data-theme="dark"] .theme-toggle .moon-icon { display: none; }
[data-theme="light"] .theme-toggle .sun-icon { display: none; }
[data-theme="light"] .theme-toggle .moon-icon { display: block; }

/* ========== BUTTONS ========== */
.btn {
  appearance: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 12px 22px;
  border-radius: 999px;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--fast-transition);
  font-size: 15px;
  font-family: var(--font-sans);
  border: 2px solid var(--brand);
  background: var(--brand);
  color: #fff;
  box-shadow: 0 4px 12px var(--shadow-color);
}
.btn:hover {
  filter: brightness(1.1);
  transform: translateY(-1px);
  box-shadow: 0 6px 18px var(--shadow-color);
}
.btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; filter: none; }

.btn.secondary, .btn-auth {
  background: var(--glass-bg);
  border: 2px solid var(--glass-border);
  color: var(--fg);
  backdrop-filter: blur(8px);
}
.btn.secondary:hover, .btn-auth:hover {
  background: var(--bg-alt);
  border-color: var(--border-glow);
}

.btn.ghost {
  background: transparent;
  border: 2px solid var(--border);
  color: var(--fg-muted);
}
.btn.ghost:hover {
  border-color: var(--border-glow);
  color: var(--fg);
}

.btn.warn {
  background: linear-gradient(135deg, #ffd36a 0%, #f5a623 100%);
  border-color: #f5a623;
  color: #1a1a1d;
}
.btn.warn:hover {
  filter: brightness(1.05);
}

.btn.large {
  padding: 16px 32px;
  font-size: 1rem;
}

.btn-sm {
  padding: 8px 16px;
  font-size: 13px;
}

/* ========== LOADING SECTION ========== */
#loading-section {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 60px 20px;
  min-height: 60vh;
}
.loading-card {
  width: 100%;
  max-width: 480px;
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-radius: var(--radius);
  border: 1px solid var(--glass-border);
  padding: 48px 28px;
  box-shadow: 0 24px 60px var(--shadow-color);
  text-align: center;
  position: relative;
  z-index: 1;
}
.loading-spinner {
  width: 48px;
  height: 48px;
  border: 3px solid var(--border);
  border-top-color: var(--brand);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 20px;
}
@keyframes spin {
  to { transform: rotate(360deg); }
}
.loading-card h2 {
  font-size: 1.5rem;
  margin-bottom: 8px;
}
.loading-card p {
  font-size: 15px;
  color: var(--fg-muted);
  max-width: 320px;
  margin: 0 auto;
}

/* ========== LOGIN SECTION ========== */
#login-section {
  display: none;
  align-items: center;
  justify-content: center;
  padding: 60px 20px;
  min-height: 60vh;
}
.login-card {
  width: 100%;
  max-width: 480px;
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-radius: var(--radius);
  border: 1px solid var(--glass-border);
  padding: 32px 28px;
  box-shadow: 0 24px 60px var(--shadow-color);
  text-align: center;
  position: relative;
  z-index: 1;
}
.login-card .eyebrow {
  font-size: 12px;
  color: var(--brand);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  margin-bottom: 8px;
  font-weight: 600;
}
.login-card h2 {
  font-size: 1.75rem;
  margin-bottom: 12px;
}
.login-card p {
  font-size: 15px;
  color: var(--fg-muted);
  margin-bottom: 24px;
  max-width: 360px;
  margin-left: auto;
  margin-right: auto;
}
.login-card .btn { width: 100%; max-width: 280px; }
.login-card .tiny {
  margin-top: 16px;
  font-size: 12px;
  color: var(--fg-muted);
}

body.authed #loading-section { display: none; }
body.authed #login-section { display: none; }
body.authed #app-main { display: block; }
body.logged-out #loading-section { display: none; }
body.logged-out #login-section { display: flex; }
body.logged-out #app-main { display: none; }

/* ========== MAIN CONSOLE ========== */
main {
  max-width: var(--maxw);
  margin: 0 auto;
  padding: 24px 16px 80px;
  position: relative;
  z-index: 1;
}
#app-main { display: none; }

/* Welcome message */
.welcome-banner {
  text-align: center;
  padding: 32px 20px;
  margin-bottom: 24px;
}
.welcome-banner h1 {
  font-size: 1.8rem;
  margin-bottom: 8px;
}
.welcome-banner p {
  font-size: 1.05rem;
  max-width: 500px;
  margin: 0 auto;
}

/* Section titles */
.section-title {
  font-size: 1rem;
  color: var(--fg-muted);
  font-weight: 600;
  margin-bottom: 16px;
  margin-top: 32px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border);
  font-family: var(--font-sans);
  display: flex;
  align-items: center;
  gap: 10px;
}
.section-title:first-of-type { margin-top: 0; }
.section-title .icon {
  font-size: 1.2rem;
}

/* ========== GRID ========== */
.grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 20px;
  margin-bottom: 24px;
}
@media (min-width: 900px) {
  .grid { grid-template-columns: 1fr 1fr; }
}
.grid.full { grid-template-columns: 1fr; }
.grid.three {
  grid-template-columns: 1fr;
}
@media (min-width: 700px) {
  .grid.three { grid-template-columns: 1fr 1fr 1fr; }
}

/* ========== CARDS ========== */
.card {
  background: var(--glass-bg);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius);
  padding: 24px;
  box-shadow: 0 8px 32px var(--shadow-color);
  transition: border-color var(--fast-transition), box-shadow var(--fast-transition);
}
.card:hover {
  border-color: var(--border-glow);
}
.card h3 {
  font-size: 1.25rem;
  margin: 0 0 8px 0;
  display: flex;
  align-items: center;
  gap: 10px;
}
.card h3 .card-icon {
  font-size: 1.3rem;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}
.card h3 .card-icon svg {
  width: 28px;
  height: 28px;
}
.card .desc {
  color: var(--fg-muted);
  font-size: 15px;
  margin: 0 0 16px 0;
  line-height: 1.6;
}

/* HIGHLIGHTED CARD (for primary actions) */
.card.highlight {
  border: 2px solid var(--highlight-border);
  background: var(--highlight-bg);
  box-shadow: 0 8px 32px var(--shadow-color), 0 0 0 1px var(--highlight-border);
}
.card.highlight:hover {
  border-color: var(--brand);
}
.card.highlight h3 {
  color: var(--brand);
}

/* ========== ROUTE SELECTION CARDS ========== */
.route-card {
  background: var(--glass-bg);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border: 2px solid var(--glass-border);
  border-radius: var(--radius);
  padding: 24px;
  text-align: center;
  cursor: pointer;
  transition: all var(--fast-transition);
}
.route-card:hover {
  border-color: var(--border-glow);
  transform: translateY(-2px);
}
.route-card.selected {
  border-color: var(--brand);
  background: var(--highlight-bg);
}
.route-card .route-icon {
  width: 64px;
  height: 64px;
  margin: 0 auto 12px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.route-card .route-icon svg {
  width: 100%;
  height: 100%;
}
.route-card h4 {
  font-family: var(--font-sans);
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 8px;
}
.route-card p {
  font-size: 14px;
  margin: 0;
}
.route-card .route-tag {
  display: inline-block;
  margin-top: 12px;
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
}
.route-card .route-tag.auto {
  background: rgba(103,232,163,0.15);
  color: var(--ok);
}
.route-card .route-tag.manual {
  background: rgba(90,129,255,0.15);
  color: var(--brand);
}

/* ========== FORM ELEMENTS ========== */
label {
  display: block;
  font-size: 13px;
  color: var(--fg-muted);
  margin-bottom: 6px;
  font-weight: 500;
}
input, select, textarea {
  width: 100%;
  padding: 12px 14px;
  background: var(--bg-input);
  border: 1px solid var(--border);
  color: var(--fg);
  border-radius: var(--radius-sm);
  font-size: 1rem;
  font-family: var(--font-sans);
  outline: none;
  transition: border-color var(--fast-transition), box-shadow var(--fast-transition);
}
input:focus, select:focus, textarea:focus {
  border-color: var(--brand);
  box-shadow: 0 0 0 3px rgba(90,129,255,0.15);
}
input.mono, textarea.mono, .mono {
  font-family: var(--font-mono);
  font-size: 14px;
}
textarea { min-height: 100px; resize: vertical; }
select {
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%239496a3' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  padding-right: 36px;
}

/* Checkbox row */
.checkbox-row {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 12px;
  font-size: 14px;
  color: var(--fg-muted);
}
.checkbox-row input[type="checkbox"] {
  width: auto;
  margin: 0;
}

/* Row layouts */
.row {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  margin-bottom: 12px;
}
.row:last-child { margin-bottom: 0; }
.row > div { flex: 1 1 200px; }
.row > div.narrow { flex: 0 0 140px; }
.row > div.action { flex: 0 0 auto; align-self: flex-end; }

/* Notice banners */
.notice {
  margin-top: 8px;
  padding: 10px 14px;
  background: rgba(90,129,255,0.1);
  border: 1px solid rgba(90,129,255,0.2);
  border-radius: var(--radius-sm);
  color: var(--brand);
  font-size: 13px;
}

/* ========== LOG / OUTPUT AREAS ========== */
.log {
  white-space: pre-wrap;
  word-break: break-word;
  font-family: var(--font-mono);
  font-size: 13px;
  background: var(--bg-input);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 14px;
  max-height: 300px;
  overflow-y: auto;
  color: var(--fg-muted);
}
.log:empty::before {
  content: 'Ready.';
  opacity: 0.5;
}

/* ========== VERIFICATION RESULTS (Human-readable) ========== */
.verify-results {
  margin-top: 16px;
}
.verify-item {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 14px 16px;
  background: var(--bg-input);
  border-radius: var(--radius-sm);
  margin-bottom: 10px;
  border: 1px solid var(--border);
}
.verify-item:last-child { margin-bottom: 0; }
.verify-icon {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  flex-shrink: 0;
}
.verify-icon.pass {
  background: rgba(103,232,163,0.15);
  color: var(--ok);
}
.verify-icon.fail {
  background: rgba(255,122,122,0.15);
  color: var(--danger);
}
.verify-icon.warn {
  background: rgba(255,211,106,0.12);
  color: var(--warn);
}
.verify-content {
  flex: 1;
}
.verify-label {
  font-weight: 600;
  color: var(--fg);
  margin-bottom: 2px;
}
.verify-status {
  font-size: 13px;
  color: var(--fg-muted);
}
.verify-status.pass { color: var(--ok); }
.verify-status.fail { color: var(--danger); }

/* Overall status banner */
.verify-summary {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px 20px;
  border-radius: var(--radius-sm);
  margin-bottom: 16px;
}
.verify-summary.all-pass {
  background: rgba(103,232,163,0.1);
  border: 1px solid rgba(103,232,163,0.3);
}
.verify-summary.has-issues {
  background: rgba(255,211,106,0.1);
  border: 1px solid rgba(255,211,106,0.3);
}
.verify-summary-icon {
  font-size: 28px;
}
.verify-summary-text h4 {
  font-family: var(--font-sans);
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 2px;
}
.verify-summary-text p {
  font-size: 14px;
  margin: 0;
}

/* ========== TABLES ========== */
.table-wrap {
  overflow-x: auto;
  margin-top: 16px;
}
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}
th, td {
  padding: 10px 12px;
  text-align: left;
  border-bottom: 1px solid var(--border);
}
th {
  font-weight: 600;
  color: var(--fg-muted);
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}
td {
  color: var(--fg);
}
.pill {
  display: inline-block;
  padding: 3px 10px;
  border-radius: 999px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
}
.pill.ok {
  background: rgba(103,232,163,0.15);
  color: var(--ok);
}
.pill.bad {
  background: rgba(255,122,122,0.12);
  color: var(--danger);
}

/* Responsive tables */
@media (max-width: 768px) {
  table, thead, tbody, th, td, tr {
    display: block;
  }
  thead tr {
    position: absolute;
    top: -9999px;
    left: -9999px;
  }
  tr {
    margin-bottom: 16px;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 12px;
    background: var(--bg-input);
  }
  td {
    border: none;
    position: relative;
    padding-left: 40%;
    padding-top: 6px;
    padding-bottom: 6px;
  }
  td::before {
    position: absolute;
    top: 6px;
    left: 12px;
    width: 35%;
    padding-right: 10px;
    white-space: nowrap;
    content: attr(data-label);
    font-weight: 600;
    color: var(--fg-muted);
    font-size: 12px;
  }
}

/* ========== DETAILS/SUMMARY ========== */
details {
  margin-top: 16px;
}
summary {
  cursor: pointer;
  font-size: 14px;
  color: var(--brand);
  font-weight: 500;
  padding: 8px 0;
}
summary:hover {
  text-decoration: underline;
}
details[open] summary {
  margin-bottom: 12px;
}

/* ========== QUICK CODES DISPLAY ========== */
.qc-cards {
  display: grid;
  gap: 16px;
  margin-top: 16px;
}
.qc-card {
  background: var(--bg-input);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 16px;
}
.qc-card-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 12px;
}
.qc-type {
  display: inline-block;
  padding: 4px 10px;
  border-radius: var(--radius-sm);
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}
.qc-type.txt {
  background: rgba(90,129,255,0.15);
  color: var(--brand);
}
.qc-type.cname {
  background: rgba(103,232,163,0.15);
  color: var(--ok);
}
.qc-purpose {
  font-size: 14px;
  color: var(--fg);
  font-weight: 600;
}
.qc-field {
  margin-bottom: 12px;
}
.qc-field:last-child { margin-bottom: 0; }
.qc-label {
  font-size: 11px;
  color: var(--fg-muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 6px;
}
.qc-value {
  display: flex;
  align-items: center;
  gap: 8px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 10px 12px;
}
.qc-value code {
  flex: 1;
  font-family: var(--font-mono);
  font-size: 13px;
  word-break: break-all;
  color: var(--fg);
}
.copy-btn {
  flex-shrink: 0;
  padding: 6px 12px;
  font-size: 12px;
  border-radius: var(--radius-sm);
  background: var(--brand);
  color: #fff;
  border: none;
  cursor: pointer;
  font-weight: 600;
  transition: all var(--fast-transition);
}
.copy-btn:hover { filter: brightness(1.1); }
.copy-btn.copied {
  background: var(--ok);
}

/* ========== SETUP FLOW SECTIONS ========== */
.setup-section {
  display: none;
}
.setup-section.active {
  display: block;
}

/* Simple back navigation */
.back-nav {
  margin-bottom: 16px;
}
.btn-back {
  background: none;
  border: none;
  color: var(--fg-muted);
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  padding: 8px 0;
  font-family: var(--font-sans);
  transition: color var(--fast-transition);
}
.btn-back:hover {
  color: var(--fg);
}

/* ========== ADMIN SECTION ========== */
.admin-section {
  margin-top: 40px;
  padding-top: 24px;
  border-top: 2px solid var(--border);
}
.admin-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
  flex-wrap: wrap;
  gap: 12px;
}
.admin-header h2 {
  font-size: 1.3rem;
  display: flex;
  align-items: center;
  gap: 10px;
}
.admin-badge {
  font-size: 11px;
  padding: 4px 10px;
  background: rgba(255,211,106,0.15);
  color: var(--warn);
  border-radius: 999px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}
.admin-toggle {
  font-size: 13px;
  color: var(--fg-muted);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
}
.admin-toggle:hover { color: var(--fg); }
.admin-content {
  display: none;
}
.admin-content.visible {
  display: block;
}

/* ========== UTILITIES ========== */
.tiny { font-size: 12px; }
.muted { color: var(--fg-muted); }
.danger { color: var(--danger); }
.text-center { text-align: center; }
.mt-sm { margin-top: 8px; }
.mt-md { margin-top: 16px; }
.mb-sm { margin-bottom: 8px; }
.mb-md { margin-bottom: 16px; }
.hidden { display: none !important; }

/* Gap between button rows */
.btn-row {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-top: 16px;
}

/* ========== DOCS SECTION ========== */
.docs-content {
  font-size: 15px;
  line-height: 1.7;
}
.docs-content strong {
  color: var(--fg);
  display: block;
  margin-top: 16px;
  margin-bottom: 6px;
}
.docs-content strong:first-child { margin-top: 0; }
.docs-content p {
  margin-bottom: 12px;
}
.docs-content .mono {
  background: var(--bg-input);
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 13px;
}

/* ========== MOBILE OPTIMIZATIONS ========== */
@media (max-width: 640px) {
  header { padding: 12px 16px; }
  .header-inner { gap: 8px; }
  .brand { font-size: 1.2rem; gap: 8px; }
  main { padding: 16px 12px 60px; }
  .card { padding: 18px 16px; }
  .card h3 { font-size: 1.1rem; }
  .btn { padding: 10px 18px; font-size: 14px; }
  .btn.large { padding: 14px 24px; font-size: 15px; }
  .row > div { flex: 1 1 100%; }
  .row > div.narrow { flex: 1 1 100%; }
  .row > div.action { width: 100%; }
  .btn-row { flex-direction: column; }
  .btn-row .btn { width: 100%; }
  .login-card { padding: 24px 20px; }
  .login-card h2 { font-size: 1.5rem; }
  .welcome-banner h1 { font-size: 1.5rem; }
  .route-card { padding: 18px 16px; }
  .route-card .route-icon { width: 56px; height: 56px; }
}

/* Touch-friendly tap targets */
@media (max-width: 768px) {
  input, select, textarea {
    font-size: 16px;
    min-height: 48px;
  }
  .btn { min-height: 48px; }
}

/* ========== ANIMATIONS ========== */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
.card {
  animation: fadeIn 0.4s ease;
}
@keyframes pulse {
  0%, 100% { box-shadow: 0 0 0 0 rgba(90,129,255,0.4); }
  50% { box-shadow: 0 0 0 8px rgba(90,129,255,0); }
}
.card.highlight {
  animation: fadeIn 0.4s ease, pulse 2s ease-in-out 3;
}

/* ========== FOOTER ========== */
/* Plan gate card */
#plan-gate {
  margin-bottom: 18px;
}
#plan-gate .desc {
  max-width: 540px;
}

.console-footer {
  text-align: center;
  padding: 24px;
  font-size: 13px;
  color: var(--fg-muted);
  border-top: 1px solid var(--border);
  margin-top: 40px;
}
.console-footer a {
  color: var(--brand);
}
  </style>
</head>
<body>

<header>
  <div class="header-inner">
    <a href="https://www.domainsafepro.com" class="brand">
      <span class="brand-text">DomainSafePro</span>
      <span class="header-tag">Setup and manage your email protection</span>
    </a>
    <div class="auth-bar" id="auth-bar">
      <span id="auth-status-label">Not signed in</span>
      <span id="auth-plan-label" class="tiny muted"></span>
      <button class="btn secondary btn-sm btn-auth" id="auth-login-btn" type="button">Sign in with Google</button>
      <button class="theme-toggle" type="button" onclick="toggleTheme()" aria-label="Toggle theme">
        <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
        <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
      </button>
    </div>
  </div>
</header>

<!-- Loading state (shown initially while checking auth) -->
<section id="loading-section">
  <div class="loading-card">
    <div class="loading-spinner"></div>
    <h2>Loading...</h2>
    <p>Checking your authentication status</p>
  </div>
</section>

<!-- Login hero (shown when not signed in) -->
<section id="login-section">
  <div class="login-card">
    <div class="eyebrow">DomainSafePro</div>
    <h2>Welcome Back</h2>
    <p>Sign in with your Google account to set up protection for your domain and manage your email security.</p>
    <button class="btn" type="button" id="login-hero-btn">Sign in with Google</button>
    <div class="tiny">You will be redirected back here after signing in.</div>
  </div>
</section>

<!-- Main app (hidden until authed) -->
<main id="app-main">

  <div id="plan-gate" class="card highlight hidden">
    <h3><span class="card-icon">üîí</span> Activate Your DomainSafePro Plan</h3>
    <p class="desc">You are signed in as <span id="plan-gate-email" class="mono"></span>, but do not yet have an active DomainSafePro subscription connected to this account.</p>
    <p class="tiny muted mt-sm">Choose a plan to unlock automatic setup (Cloudflare, Route 53) and domain monitoring. Once your purchase is complete, return here with the same Google account to connect your domain.</p>
    <div class="row mt-sm">
      <div class="action">
        <a class="btn" href="https://www.domainsafepro.com/#pricing">View plans on main site</a>
      </div>
    </div>
  </div>


  <!-- Welcome banner -->
  <div class="welcome-banner">
    <h1>Where Is Your DNS Hosted?</h1>
    <p>Your domain's DNS is managed by one provider. Select yours below to get started.</p>
  </div>

  <!-- ROUTE SELECTION -->
  <section class="grid three" id="route-selection">
    <div class="route-card" data-route="cloudflare" onclick="selectRoute('cloudflare')">
      <div class="route-icon">
        <!-- Cloudflare Logo SVG -->
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="cf-grad-1" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#F6821F"/>
              <stop offset="100%" style="stop-color:#FAAD3F"/>
            </linearGradient>
            <linearGradient id="cf-grad-2" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#F6821F"/>
              <stop offset="100%" style="stop-color:#F9A51B"/>
            </linearGradient>
          </defs>
          <path fill="url(#cf-grad-1)" d="M44.5,45.3H15.6c-0.4,0-0.7-0.3-0.8-0.6c-0.1-0.4,0.1-0.8,0.4-1l3.5-2.1c0.6-0.4,1.3-0.6,2-0.6h22.5c5.2,0,9.7-3.6,10.5-8.7c0.5-3-0.3-5.9-2.2-8.1c-1.9-2.2-4.6-3.5-7.6-3.5h-0.6c-0.3,0-0.6-0.2-0.7-0.5c-1.6-4.8-6.1-8-11.3-8c-5.6,0-10.4,3.8-11.7,9.2c-0.1,0.3-0.3,0.5-0.6,0.5c-2.5,0.1-4.8,1.2-6.4,3.1c-1.6,1.9-2.4,4.4-2.1,6.9c0.5,4.5,4.5,7.9,9.1,7.9h0.3c0.4,0,0.7,0.3,0.8,0.6c0.1,0.4-0.1,0.8-0.4,1l-3.5,2.1c-0.6,0.4-1.3,0.6-2,0.6h-0.3c-7.3,0-13.6-5.4-14.3-12.6c-0.4-4,0.8-7.9,3.3-10.9c2.3-2.8,5.6-4.6,9.2-5.1C14.9,8.9,21.8,4,29.7,4c7.2,0,13.6,4.2,16.6,10.5h0.4c4.6,0,8.9,2,11.9,5.5c2.9,3.4,4.2,7.9,3.5,12.4C61,40.4,53.3,45.3,44.5,45.3z"/>
          <path fill="url(#cf-grad-2)" d="M50.3,45.3h-5.8c-0.4,0-0.7-0.3-0.8-0.6c-0.1-0.4,0.1-0.8,0.4-1l3.5-2.1c0.6-0.4,1.3-0.6,2-0.6h0.7c3.3,0,6.1-2.3,6.7-5.5c0.3-1.9-0.2-3.8-1.4-5.2c-1.2-1.4-2.9-2.2-4.8-2.2h-2.5c-0.4,0-0.7-0.3-0.7-0.6c-0.8-4.4-4.6-7.7-9.2-7.7c-0.9,0-1.7,0.1-2.5,0.3c-0.3,0.1-0.6,0-0.8-0.2c-0.2-0.2-0.3-0.5-0.2-0.8c0.7-2.1,1.1-4.4,1.1-6.7c0-0.8-0.1-1.6-0.1-2.4c2.3,0.6,4.4,1.7,6.3,3.1h0.4c4.6,0,8.9,2,11.9,5.5c2.9,3.4,4.2,7.9,3.5,12.4C57.1,38.9,54.2,42.8,50.3,45.3z"/>
        </svg>
      </div>
      <h4>Cloudflare</h4>
      <p>I manage my DNS through Cloudflare.</p>
      <span class="route-tag auto">Automatic Setup</span>
    </div>
    <div class="route-card" data-route="route53" onclick="selectRoute('route53')">
      <div class="route-icon">
        <!-- AWS Route 53 Logo SVG -->
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="aws-grad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#8C4FFF"/>
              <stop offset="100%" style="stop-color:#5829A7"/>
            </linearGradient>
          </defs>
          <rect x="6" y="6" width="52" height="52" rx="4" fill="url(#aws-grad)"/>
          <path fill="#fff" d="M32,14c-9.9,0-18,8.1-18,18s8.1,18,18,18s18-8.1,18-18S41.9,14,32,14z M32,46c-7.7,0-14-6.3-14-14s6.3-14,14-14s14,6.3,14,14S39.7,46,32,46z"/>
          <path fill="#fff" d="M32,20c-6.6,0-12,5.4-12,12s5.4,12,12,12s12-5.4,12-12S38.6,20,32,20z M32,40c-4.4,0-8-3.6-8-8s3.6-8,8-8s8,3.6,8,8S36.4,40,32,40z"/>
          <circle fill="#fff" cx="32" cy="32" r="4"/>
          <path fill="#fff" d="M46,30h4v4h-4V30z M14,30h4v4h-4V30z M30,14h4v4h-4V14z M30,46h4v4h-4V46z"/>
        </svg>
      </div>
      <h4>AWS Route 53</h4>
      <p>I manage my DNS through AWS.</p>
      <span class="route-tag auto">Automatic Setup</span>
    </div>
    <div class="route-card" data-route="manual" onclick="selectRoute('manual')">
      <div class="route-icon">
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <rect x="10" y="8" width="44" height="48" rx="4" fill="var(--bg-card)" stroke="var(--fg-muted)"/>
          <line x1="18" y1="20" x2="46" y2="20" stroke="var(--fg-muted)"/>
          <line x1="18" y1="28" x2="46" y2="28" stroke="var(--fg-muted)"/>
          <line x1="18" y1="36" x2="38" y2="36" stroke="var(--fg-muted)"/>
          <line x1="18" y1="44" x2="34" y2="44" stroke="var(--fg-muted)"/>
        </svg>
      </div>
      <h4>Other Provider</h4>
      <p>GoDaddy, Namecheap, Google Domains, or another registrar.</p>
      <span class="route-tag manual">Copy-Paste Setup</span>
    </div>
  </section>

  <!-- ========== CLOUDFLARE SETUP FLOW ========== -->
  <div id="setup-cloudflare" class="setup-section">
    <div class="back-nav">
      <button class="btn-back" onclick="selectRoute(null)">‚Üê Back</button>
    </div>

    <section class="grid full">
      <div class="card highlight">
        <h3>
          <span class="card-icon">
            <svg viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="cf-card-grad" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#F6821F"/>
                  <stop offset="100%" style="stop-color:#FAAD3F"/>
                </linearGradient>
              </defs>
              <path fill="url(#cf-card-grad)" d="M19.5,19.8H6.8c-0.2,0-0.3-0.1-0.3-0.3c0-0.2,0-0.3,0.2-0.4l1.5-0.9c0.3-0.2,0.6-0.3,0.9-0.3h9.9c2.3,0,4.2-1.6,4.6-3.8c0.2-1.3-0.1-2.6-1-3.5c-0.8-1-2-1.5-3.3-1.5h-0.3c-0.1,0-0.3-0.1-0.3-0.2c-0.7-2.1-2.7-3.5-4.9-3.5c-2.4,0-4.5,1.7-5.1,4c0,0.1-0.1,0.2-0.3,0.2c-1.1,0-2.1,0.5-2.8,1.4c-0.7,0.8-1,1.9-0.9,3c0.2,2,2,3.4,4,3.4h0.1c0.2,0,0.3,0.1,0.3,0.3c0,0.2,0,0.3-0.2,0.4l-1.5,0.9c-0.3,0.2-0.6,0.3-0.9,0.3h-0.1c-3.2,0-5.9-2.4-6.2-5.5c-0.2-1.7,0.3-3.4,1.4-4.8c1-1.2,2.4-2,4-2.2C6.5,3.9,9.5,1.7,13,1.7c3.1,0,5.9,1.8,7.2,4.6h0.2c2,0,3.9,0.9,5.2,2.4c1.3,1.5,1.8,3.4,1.5,5.4C26.6,17.6,23.3,19.8,19.5,19.8z"/>
            </svg>
          </span>
          Connect Your Cloudflare Account
        </h3>
        <p class="desc">Paste your Cloudflare API token below and we will automatically configure all your email security records. You need a token with "Zone Read" and "DNS Edit" permissions.</p>
        
        <div class="row">
          <div>
            <label for="cf-token">Cloudflare API Token</label>
            <input id="cf-token" class="mono" type="password" placeholder="Paste your API token here" autocomplete="off"/>
          </div>
          <div class="action">
            <button class="btn secondary" id="btnCfList">Load My Domains</button>
          </div>
        </div>
        
        <div class="row">
          <div>
            <label for="cf-zones">Select your domain</label>
            <select id="cf-zones"><option value="">First, load your domains above</option></select>
          </div>
          <div class="action">
            <button class="btn large" id="btnCfProtect">Protect This Domain</button>
          </div>
        </div>
        
        <pre class="log mt-md" id="cf-log">Paste your API token and click "Load My Domains" to get started.</pre>

        <details class="mt-md">
          <summary>How do I get a Cloudflare API token?</summary>
          <div class="docs-content">
            <p>1. Log in to your Cloudflare dashboard</p>
            <p>2. Go to "My Profile" (top right) then "API Tokens"</p>
            <p>3. Click "Create Token"</p>
            <p>4. Use the "Edit zone DNS" template</p>
            <p>5. Under "Zone Resources", select the zones you want to protect</p>
            <p>6. Click "Continue to summary" then "Create Token"</p>
            <p>7. Copy the token and paste it above</p>
          </div>
        </details>
      </div>
    </section>
  </div>

  <!-- ========== ROUTE 53 SETUP FLOW ========== -->
  <div id="setup-route53" class="setup-section">
    <div class="back-nav">
      <button class="btn-back" onclick="selectRoute(null)">‚Üê Back</button>
    </div>

    <section class="grid full">
      <div class="card highlight">
        <h3>
          <span class="card-icon">
            <svg viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="aws-card-grad" x1="0%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" style="stop-color:#8C4FFF"/>
                  <stop offset="100%" style="stop-color:#5829A7"/>
                </linearGradient>
              </defs>
              <rect x="2" y="2" width="24" height="24" rx="2" fill="url(#aws-card-grad)"/>
              <circle cx="14" cy="14" r="8" fill="none" stroke="#fff" stroke-width="1.5"/>
              <circle cx="14" cy="14" r="5" fill="none" stroke="#fff" stroke-width="1.5"/>
              <circle cx="14" cy="14" r="2" fill="#fff"/>
            </svg>
          </span>
          Connect Your AWS Account
        </h3>
        <p class="desc">Enter your AWS IAM credentials below and we will automatically configure all your email security records. You need an IAM user with Route 53 access.</p>
        
        <div class="row">
          <div>
            <label for="r53-ak">Access Key ID</label>
            <input id="r53-ak" class="mono" placeholder="AKIA..." autocomplete="off"/>
          </div>
          <div>
            <label for="r53-sk">Secret Access Key</label>
            <input id="r53-sk" class="mono" type="password" placeholder="Your secret key" autocomplete="off"/>
          </div>
        </div>
        
        <div class="row">
          <div>
            <label for="r53-zones">Select your hosted zone</label>
            <select id="r53-zones"><option value="">Enter credentials to load zones</option></select>
          </div>
          <div class="action">
            <button class="btn large" id="btnR53Protect">Protect This Domain</button>
          </div>
        </div>
        
        <pre class="log mt-md" id="r53-log">Enter your AWS credentials. Zones will load automatically.</pre>

        <details class="mt-md">
          <summary>How do I get AWS IAM credentials?</summary>
          <div class="docs-content">
            <p>1. Log in to your AWS Console</p>
            <p>2. Go to IAM (Identity and Access Management)</p>
            <p>3. Create a new user or use an existing one</p>
            <p>4. Attach the "AmazonRoute53FullAccess" policy</p>
            <p>5. Go to "Security credentials" and create an access key</p>
            <p>6. Copy both the Access Key ID and Secret Access Key</p>
          </div>
        </details>
      </div>
    </section>
  </div>

  <!-- ========== MANUAL DNS SETUP FLOW ========== -->
  <div id="setup-manual" class="setup-section">
    <div class="back-nav">
      <button class="btn-back" onclick="selectRoute(null)">‚Üê Back</button>
    </div>

    <!-- STEP 1: GET YOUR CODES -->
    <section class="grid full">
      <div class="card highlight">
        <h3><span class="card-icon">üìã</span> Step 1: Get Your DNS Records</h3>
        <p class="desc">Enter your domain below and we will generate the DNS records you need. Then copy each record and add it at your domain registrar.</p>
        
        <div class="row">
          <div>
            <label for="qc-domain">Your domain name</label>
            <input id="qc-domain" class="mono" placeholder="yourdomain.com" autocapitalize="off" autocorrect="off" spellcheck="false"/>
            <div class="notice hidden" id="qc-notice"></div>
          </div>
          <div class="action">
            <button class="btn large" id="btnQCodes">Generate My Records</button>
          </div>
        </div>
        
        <div class="checkbox-row">
          <input type="checkbox" id="qc-extras"/>
          <label for="qc-extras" style="margin:0">Include advanced security records (MTA-STS and TLS reporting)</label>
        </div>

        <div id="qc-results" class="hidden"></div>
        
        <div id="qc-actions" class="btn-row hidden">
          <button class="btn secondary btn-sm" id="btnCopyAll">Copy All as Text</button>
        </div>
      </div>
    </section>

    <!-- STEP 2: Instructions -->
    <section class="grid full">
      <div class="card">
        <h3><span class="card-icon">üìù</span> Step 2: Add Records to Your DNS</h3>
        <p class="desc">Log in to your domain registrar and add each record from Step 1. Here is what to look for:</p>
        
        <div class="docs-content">
          <strong>Where to add these records</strong>
          <p>Go to your domain registrar (the company where you bought your domain) and find the DNS settings. Common places include: "DNS Management", "DNS Records", or "Zone Editor".</p>
          
          <strong>Adding TXT records</strong>
          <p>For TXT records, create a new record with the "Host" (or "Name") and "Value" exactly as shown. The Host field is usually just the prefix like <code>_dmarc</code>, not the full domain.</p>
          
          <strong>Adding CNAME records</strong>
          <p>For CNAME records, the "Points to" or "Value" field should be the target address we provide. Some registrars add your domain automatically, so just enter the prefix.</p>
          
          <strong>When will it work?</strong>
          <p>DNS changes can take a few minutes to a few hours to spread across the internet. If verification fails at first, wait 15 minutes and try again.</p>
        </div>
      </div>
    </section>
  </div>

  <!-- ========== VERIFY SETUP (Always visible after route selected) ========== -->
  <div id="verify-section" class="setup-section">
    <section class="grid full">
      <div class="card highlight">
        <h3><span class="card-icon">‚úÖ</span> Verify Your Setup</h3>
        <p class="desc">Check if your domain's email protection is configured correctly. We will test each record and tell you if anything needs attention.</p>
        
        <div class="row">
          <div>
            <label for="verify-domain">Domain to verify</label>
            <input id="verify-domain" class="mono" placeholder="yourdomain.com" autocapitalize="off" autocorrect="off" spellcheck="false"/>
            <div class="notice hidden" id="verify-notice"></div>
          </div>
          <div class="action">
            <button class="btn large" id="btnVerify">Verify My Setup</button>
          </div>
        </div>
        
        <div id="verify-results" class="verify-results hidden"></div>
        
        <details class="hidden" id="verify-details">
          <summary>View technical details</summary>
          <div>
            <pre id="verify-log" class="log tiny">Waiting for verification...</pre>
          </div>
        </details>
      </div>
    </section>
  </div>

  <!-- HELP SECTION (Always visible) -->
  <section class="grid full" id="help-section">
    <div class="card">
      <h3><span class="card-icon">üí°</span> Need Help?</h3>
      <div class="docs-content">
        <strong>Not sure which DNS provider you use?</strong>
        <p>Your DNS is typically managed by whoever you registered your domain with (like GoDaddy, Namecheap), or by a service you pointed your nameservers to (like Cloudflare or AWS). Check your domain registrar's settings if unsure.</p>
        
        <strong>Already protected but showing errors?</strong>
        <p>If you set up protection through Cloudflare or Route 53 but verification shows issues, wait a few minutes for DNS to propagate and try again.</p>
      </div>
    </div>
  </section>

  <!-- ============================================================ -->
  <!-- ADMIN / OWNER SECTION (Collapsible) -->
  <!-- ============================================================ -->
  <div class="admin-section">
    <div class="admin-header">
      <h2><span>üîß</span> Admin Tools</h2>
      <div class="admin-toggle" id="admin-toggle" onclick="toggleAdmin()">
        <span id="admin-toggle-text">Show admin tools</span>
        <span id="admin-toggle-icon">‚ñº</span>
      </div>
    </div>

    <div class="admin-content" id="admin-content">

      <!-- DOMAIN STATUS -->
      <div class="section-title"><span class="icon">üìä</span> Connected Domains</div>
      <section class="grid full">
        <div class="card">
          <h3>Domain Health Dashboard</h3>
          <p class="desc">All domains under your account with their current protection status. The robot checks these automatically every day.</p>
          <div class="btn-row">
            <button class="btn btn-sm" id="btnStatus">Refresh Status</button>
            <button class="btn btn-sm secondary" id="btnMonitor">Run Check Now</button>
          </div>
          <div class="mt-md table-wrap">
            <table id="statusTable">
              <thead>
                <tr>
                  <th>Domain</th>
                  <th>Owner</th>
                  <th>SPF</th>
                  <th>DMARC</th>
                  <th>DKIM s1</th>
                  <th>DKIM s2</th>
                  <th>Checked</th>
                </tr>
              </thead>
              <tbody id="statusRows">
                <tr><td colspan="7" class="muted">Loading domain status...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- ADD DOMAIN -->
      <div class="section-title"><span class="icon">‚ûï</span> Register Domain</div>
      <section class="grid full">
        <div class="card">
          <h3>Add Domain to Monitoring</h3>
          <p class="desc">Register a new domain with the robot. We will start tracking its email security status automatically.</p>
          <div class="row">
            <div>
              <label for="add-email">Contact email for this domain</label>
              <input id="add-email" class="mono" placeholder="owner@example.com" type="email"/>
            </div>
            <div>
              <label for="add-domain">Domain name</label>
              <input id="add-domain" class="mono" placeholder="example.com" autocapitalize="off"/>
              <div class="notice hidden" id="add-notice"></div>
            </div>
          </div>
          <div class="btn-row">
            <button class="btn" id="btnAdd">Add Domain</button>
          </div>
          <pre class="log mt-md" id="add-log">Enter domain details above.</pre>

          <details class="mt-md">
            <summary>View registered domains</summary>
            <div id="recentWrap" class="tiny muted">Loading...</div>
          </details>
        </div>
      </section>

    </div><!-- /admin-content -->
  </div><!-- /admin-section -->

  <footer class="console-footer">
    <a href="https://domainsafepro.com" target="_blank">DomainSafePro</a> | Email Authentication on Autopilot
  </footer>

</main>

<script>
/* ====== Theme Toggle ====== */
function toggleTheme() {
  var html = document.documentElement;
  var current = html.getAttribute('data-theme');
  var next = current === 'dark' ? 'light' : 'dark';
  html.setAttribute('data-theme', next);
  try { localStorage.setItem('dsp-theme', next); } catch(e){}
}
(function(){
  try {
    var saved = localStorage.getItem('dsp-theme');
    if (saved) document.documentElement.setAttribute('data-theme', saved);
  } catch(e){}
})();

/* ====== Admin Toggle ====== */
function toggleAdmin() {
  var content = document.getElementById('admin-content');
  var text = document.getElementById('admin-toggle-text');
  var icon = document.getElementById('admin-toggle-icon');
  if (content.classList.contains('visible')) {
    content.classList.remove('visible');
    text.textContent = 'Show admin tools';
    icon.textContent = '‚ñº';
  } else {
    content.classList.add('visible');
    text.textContent = 'Hide admin tools';
    icon.textContent = '‚ñ≤';
  }
}

/* ====== Route Selection ====== */
var currentRoute = null;

function selectRoute(route) {
  currentRoute = route;
  
  // Update card selection states
  var cards = document.querySelectorAll('.route-card');
  cards.forEach(function(card) {
    if (card.getAttribute('data-route') === route) {
      card.classList.add('selected');
    } else {
      card.classList.remove('selected');
    }
  });
  
  // Show/hide appropriate sections
  var cfSection = document.getElementById('setup-cloudflare');
  var r53Section = document.getElementById('setup-route53');
  var manualSection = document.getElementById('setup-manual');
  var verifySection = document.getElementById('verify-section');
  var routeSelection = document.getElementById('route-selection');
  var helpSection = document.getElementById('help-section');
  
  // Reset all
  cfSection.classList.remove('active');
  r53Section.classList.remove('active');
  manualSection.classList.remove('active');
  verifySection.classList.remove('active');
  
  if (route === null) {
    // Show route selection, hide everything else
    routeSelection.style.display = '';
    helpSection.style.display = '';
    return;
  }
  
  // Hide route selection once a route is chosen
  routeSelection.style.display = 'none';
  
  if (route === 'cloudflare') {
    cfSection.classList.add('active');
    verifySection.classList.add('active');
  } else if (route === 'route53') {
    r53Section.classList.add('active');
    verifySection.classList.add('active');
  } else if (route === 'manual') {
    manualSection.classList.add('active');
    verifySection.classList.add('active');
  }
}

/* ====== Real endpoints ====== */
var ROBOT_API = "https://domainsafe-robot.pankajonlinerepository.workers.dev";
var DMARC_API = "https://api.domainsafepro.com";
var AUTH_API  = "https://domainsafe-robot.pankajonlinerepository.workers.dev";

/* ====== Tiny helpers ====== */
var $ = function(sel) { return document.querySelector(sel); };
var $$ = function(sel) { return document.querySelectorAll(sel); };
var logEl = function(sel, v) { 
  var el = $(sel); 
  if (!el) return; 
  el.textContent = (typeof v === "string") ? v : JSON.stringify(v, null, 2); 
};
var copy = function(txt) { 
  if (navigator.clipboard) return navigator.clipboard.writeText(txt).catch(function(){}); 
  return Promise.resolve();
};
var show = function(el) { if (el) el.classList.remove('hidden'); };
var hide = function(el) { if (el) el.classList.add('hidden'); };

function sanitizeDomain(raw){
  return (raw||"").trim().toLowerCase()
    .replace(/^https?:\/\//,"")
    .replace(/^mailto:/,"")
    .replace(/\/.*$/,"")
    .replace(/\.$/,"");
}
function isValidHostname(raw){
  var s = sanitizeDomain(raw);
  if (!/^[a-z0-9.-]+\.[a-z]{2,}$/i.test(s)) return false;
  var labels = s.split(".");
  return labels.every(function(lbl) { return lbl.length>0 && lbl.length<=63 && /^[a-z0-9-]+$/i.test(lbl); });
}
function isDomain(s){ return /^[a-z0-9.-]+\.[a-z]{2,}$/i.test(s||""); }
function apexify(raw){
  var s = sanitizeDomain(raw);
  if (!isDomain(s)) return s;
  var parts = s.split(".").filter(Boolean);
  if (parts.length <= 2) return s;
  var cc2 = ["co.uk","com.au","co.in","co.jp","com.br","com.mx","com.sg","com.hk"];
  var tail2 = parts.slice(-2).join(".");
  var tail3 = parts.slice(-3).join(".");
  return cc2.indexOf(tail2) >= 0 ? tail3 : tail2;
}
function normalizeForUI(raw, noticeEl, errorEl, opts){
  var options = opts || {};
  var typed = sanitizeDomain(raw);
  if (!isValidHostname(typed)){
    if (errorEl){
      errorEl.textContent = "Please enter a valid domain name (like yourdomain.com)";
      show(errorEl);
    }
    if (noticeEl) hide(noticeEl);
    return { ok:false, value:typed, apex:"", changed:false };
  }
  if (errorEl) hide(errorEl);
  var apex = apexify(typed);
  var value = apex, changed = false;
  if (options.allowExact){
    value = typed;
  } else if (typed !== apex){
    changed = true;
  }
  if (noticeEl){
    if (changed){
      noticeEl.innerHTML = 'We will protect the root domain <span class="mono">'+apex+'</span> to cover all subdomains.';
      show(noticeEl);
    } else {
      hide(noticeEl);
    }
  }
  return { ok:true, value:value, apex:apex, changed:changed, typed:typed };
}

/* ====== HTTP helpers ====== */
async function get(url){
  var r = await fetch(url, {
    method:"GET",
    credentials:"include",
    headers:{ "accept":"application/json" }
  });
  var t = await r.text();
  var j = null;
  try{ j = t ? JSON.parse(t) : null; }catch(e){}
  if (!r.ok){
    var msg = (j && j.error) ? j.error : t || ("HTTP "+r.status);
    throw new Error(msg);
  }
  return j;
}
async function post(url, body){
  var r = await fetch(url, {
    method:"POST",
    credentials:"include",
    headers:{ "content-type":"application/json", "accept":"application/json" },
    body: JSON.stringify(body || {})
  });
  var t = await r.text();
  var j = null;
  try{ j = t ? JSON.parse(t) : null; }catch(e){}
  if (!r.ok){
    var msg = (j && j.error) ? j.error : t || ("HTTP "+r.status);
    throw new Error(msg);
  }
  return j;
}

/* ====== AUTH (Google sign-in) ====== */
async function fetchCurrentUser(){
  try{
    var r = await fetch(AUTH_API + "/api/me", {
      method:"GET",
      credentials:"include",
      headers:{ "accept":"application/json" }
    });
    var t = await r.text();
    var j = null;
    try{ j = t ? JSON.parse(t) : null; }catch(e){ return null; }
    if (!r.ok || !j || j.ok === false || !j.user || !j.user.email) return null;
    return j.user;
  }catch(e){
    return null;
  }
}

function startGoogleLogin(){
  window.location.href = AUTH_API + "/auth/google/start";
}

function applyPlanGate(user){
  var gate = $("#plan-gate");
  var gateEmail = $("#plan-gate-email");
  var welcomeBanner = $(".welcome-banner");
  var routeSelection = $("#route-selection");
  var cfSetup = $("#setup-cloudflare");
  var r53Setup = $("#setup-route53");
  var manualSetup = $("#setup-manual");
  var helpSection = $("#help-section");
  var adminSection = document.querySelector(".admin-section");

  var email = user && user.email ? String(user.email) : "";
  var plan = user && user.plan ? user.plan : null;
  var lower = email.toLowerCase();
  var isAdminFront = (lower === "pankajonlinerepository@gmail.com" || lower === "ops@domainsafepro.com");
  var hasActivePlan = !!(plan && plan.status === "active");

  if (gateEmail && email){
    gateEmail.textContent = email;
  }

  var sections = [welcomeBanner, routeSelection, cfSetup, r53Setup, manualSetup, helpSection, adminSection];

  if (hasActivePlan || isAdminFront) {
    if (gate) gate.classList.add("hidden");
    sections.forEach(function(el){ if (el) el.classList.remove("hidden"); });
  } else {
    if (gate) gate.classList.remove("hidden");
    sections.forEach(function(el){ if (el) el.classList.add("hidden"); });
  }
}

function showAuthedUI(user){
  document.body.classList.remove("logged-out");
  document.body.classList.add("authed");
  var label = $("#auth-status-label");
  var planLabel = $("#auth-plan-label");
  var loginBtn = $("#auth-login-btn");
  if (label && user && user.email){
    label.textContent = user.email;
  }
  if (planLabel){
    if (user && user.plan && user.plan.code){
      var plan = user.plan;
      var parts = [];
      parts.push("Plan: " + String(plan.code));
      if (typeof plan.domains_used === "number" && (plan.max_domains === null || typeof plan.max_domains === "number")){
        var used = plan.domains_used;
        var max = plan.max_domains;
        if (max === null){
          parts.push("Domains: " + used + "+");
        } else {
          parts.push("Domains: " + used + "/" + max);
        }
      }
      if (plan.valid_until){
        parts.push("Until: " + String(plan.valid_until).slice(0,10));
      }
      planLabel.textContent = parts.join(" ¬∑ ");
      planLabel.classList.remove("hidden");
    } else {
      planLabel.textContent = "";
      planLabel.classList.add("hidden");
    }
  }
  if (loginBtn) {
    loginBtn.textContent = "Sign out";
    loginBtn.onclick = function() {
      // Redirect to landing page on logout
      window.location.href = "https://www.domainsafepro.com";
    };
  }
  applyPlanGate(user);
  var statusRows = $("#statusRows");
  if (statusRows){
    statusRows.innerHTML = '<tr><td colspan="7" class="muted">Loading...</td></tr>';
  }
  var addEmail = $("#add-email");
  if (addEmail && user && user.email){
    addEmail.value = user.email;
  }
  loadStatus();
  refreshRecent();
}

function showLoggedOutUI(){
  document.body.classList.remove("authed");
  document.body.classList.add("logged-out");
  var label = $("#auth-status-label");
  var planLabel = $("#auth-plan-label");
  var loginBtn = $("#auth-login-btn");
  if (label) label.textContent = "Not signed in";
  if (planLabel){
    planLabel.textContent = "";
    planLabel.classList.add("hidden");
  }
  if (loginBtn) {
    loginBtn.textContent = "Sign in with Google";
    loginBtn.onclick = startGoogleLogin;
  }
  var statusRows = $("#statusRows");
  if (statusRows){
    statusRows.innerHTML = '<tr><td colspan="7" class="muted">Sign in to see your connected domains.</td></tr>';
  }
  var recent = $("#recentWrap");
  if (recent) recent.textContent = "Sign in to see your domains.";
  var addEmail = $("#add-email");
  if (addEmail) addEmail.value = "";
  var addLog = $("#add-log");
  if (addLog) addLog.textContent = "Enter domain details above.";
}

async function initAuth(){
  var btnHeader = $("#auth-login-btn");
  var btnHero   = $("#login-hero-btn");
  if (btnHeader) btnHeader.addEventListener("click", startGoogleLogin);
  if (btnHero)   btnHero.addEventListener("click", startGoogleLogin);

  // Show loading state initially (already shown by default)
  // Now fetch user
  var user = await fetchCurrentUser();
  
  // Hide loading and show appropriate UI
  if (user) {
    showAuthedUI(user);
  } else {
    showLoggedOutUI();
  }
}

/* ====== STATUS & MONITOR ====== */
function pill(ok){
  return ok
    ? '<span class="pill ok">OK</span>'
    : '<span class="pill bad">Needs setup</span>';
}

async function loadStatus(){
  var tb = $("#statusRows");
  if (!tb) return;
  tb.innerHTML = '<tr><td colspan="7" class="muted">Loading...</td></tr>';
  try{
    var j = await get(ROBOT_API + "/api/status");
    var rows = (j && j.rows) ? j.rows : [];
    if (!rows.length){
      tb.innerHTML = '<tr><td colspan="7" class="muted">No domains registered yet. Add your first domain above.</td></tr>';
      return;
    }
    tb.innerHTML = rows.map(function(r) {
      return '<tr>' +
        '<td data-label="Domain" class="mono">'+(r.domain_name||"")+'</td>' +
        '<td data-label="Owner" class="mono tiny">'+(r.email||"")+'</td>' +
        '<td data-label="SPF">'+pill(r.spf_ok)+'</td>' +
        '<td data-label="DMARC">'+pill(r.dmarc_ok)+'</td>' +
        '<td data-label="DKIM s1">'+pill(r.dkim_s1_ok)+'</td>' +
        '<td data-label="DKIM s2">'+pill(r.dkim_s2_ok)+'</td>' +
        '<td data-label="Checked" class="tiny muted">'+(r.checked_at||"")+'</td>' +
      '</tr>';
    }).join("");
  }catch(e){
    tb.innerHTML = '<tr><td colspan="7" class="tiny danger">Could not load status. Please try again.</td></tr>';
  }
}
$("#btnStatus").addEventListener("click", loadStatus);
$("#btnMonitor").addEventListener("click", async function(){
  try{ await post(ROBOT_API + "/api/monitor-run", {}); }catch(e){}
  loadStatus();
});

/* ====== QUICK-CODES (Customer-facing) ====== */
function renderQuickCodes(records, extras) {
  var container = $("#qc-results");
  if (!records || records.length === 0) {
    container.innerHTML = '<p class="muted">No records to display.</p>';
    show(container);
    return;
  }

  function getPurpose(name) {
    if (name.indexOf('_domainkey') >= 0) {
      return name.indexOf('s1') === 0 ? 'Email Signature Key 1 (DKIM)' : 'Email Signature Key 2 (DKIM)';
    }
    if (name === '_dmarc' || name.indexOf('_dmarc.') === 0) return 'Email Policy (DMARC)';
    if (name === '@' || name === '') return 'Email Sender Authorization (SPF)';
    if (name === '_smtp._tls') return 'Transport Security Reporting';
    if (name === 'mta-sts') return 'Mail Transfer Security';
    return 'DNS Record';
  }

  function escapeHtml(str) {
    return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
  }

  function createCard(r) {
    var typeClass = r.type.toLowerCase() === 'txt' ? 'txt' : 'cname';
    var purpose = getPurpose(r.name);
    var displayName = r.name === '@' ? '@ (root domain)' : escapeHtml(r.name);
    var escapedName = escapeHtml(r.name);
    var escapedValue = escapeHtml(r.value);
    
    return '<div class="qc-card">' +
      '<div class="qc-card-header">' +
        '<span class="qc-type ' + typeClass + '">' + escapeHtml(r.type) + '</span>' +
        '<span class="qc-purpose">' + purpose + '</span>' +
      '</div>' +
      '<div class="qc-field">' +
        '<div class="qc-label">Host / Name</div>' +
        '<div class="qc-value">' +
          '<code>' + displayName + '</code>' +
          '<button class="copy-btn" data-copy="' + escapedName + '">Copy</button>' +
        '</div>' +
      '</div>' +
      '<div class="qc-field">' +
        '<div class="qc-label">Value / Points To</div>' +
        '<div class="qc-value">' +
          '<code>' + escapedValue + '</code>' +
          '<button class="copy-btn" data-copy="' + escapedValue + '">Copy</button>' +
        '</div>' +
      '</div>' +
    '</div>';
  }

  var html = '<div class="qc-cards">';
  records.forEach(function(r) { html += createCard(r); });
  if (extras && extras.length > 0) {
    html += '<div class="mt-md mb-sm"><strong class="tiny muted">ADVANCED SECURITY (OPTIONAL)</strong></div>';
    extras.forEach(function(r) { html += createCard(r); });
  }
  html += '</div>';

  container.innerHTML = html;
  show(container);
  show($("#qc-actions"));
  
  // Add click handlers for copy buttons
  container.querySelectorAll('.copy-btn').forEach(function(btn) {
    btn.addEventListener('click', function() {
      var text = this.getAttribute('data-copy');
      var button = this;
      copy(text).then(function() {
        button.textContent = 'Copied!';
        button.classList.add('copied');
        setTimeout(function() {
          button.textContent = 'Copy';
          button.classList.remove('copied');
        }, 2000);
      });
    });
  });
}

$("#btnQCodes").addEventListener("click", async function(){
  var norm = normalizeForUI($("#qc-domain").value, $("#qc-notice"), null);
  if (!norm.ok){
    hide($("#qc-results"));
    hide($("#qc-actions"));
    return;
  }
  try{
    var extras = ($("#qc-extras").checked ? "&extras=1" : "");
    var j = await get(ROBOT_API + "/api/quick-codes?domain=" + encodeURIComponent(norm.apex || norm.value) + extras);
    renderQuickCodes(j.records || [], j.extras || []);
    
    $("#verify-domain").value = norm.apex || norm.value;
  }catch(e){
    $("#qc-results").innerHTML = '<p class="danger">Could not generate records: ' + String(e).slice(0,100) + '</p>';
    show($("#qc-results"));
  }
});

$("#btnCopyAll").addEventListener("click", function(){
  var cards = $$("#qc-results .qc-card");
  if (!cards.length) return;
  
  var text = "";
  cards.forEach(function(card) {
    var typeEl = card.querySelector('.qc-type');
    var codeEls = card.querySelectorAll('.qc-value code');
    var type = typeEl ? typeEl.textContent : '';
    var name = codeEls[0] ? codeEls[0].textContent : '';
    var value = codeEls[1] ? codeEls[1].textContent : '';
    text += type + "\t" + name + "\t" + value + "\n";
  });
  
  copy(text).then(function() {
    var btn = $("#btnCopyAll");
    var oldText = btn.textContent;
    btn.textContent = "Copied to clipboard!";
    setTimeout(function() { btn.textContent = oldText; }, 2000);
  });
});

/* ====== VERIFY (Human-readable output) - FIXED to match API response ====== */
function renderVerifyResults(data) {
  var container = $("#verify-results");
  var detailsEl = $("#verify-details");
  
  var checks = data.checks || {};
  var items = [];
  
  // SPF check - API returns "includesControl" (camelCase), not "includes_control"
  var spfPresent = checks.spf && checks.spf.present;
  var spfIncludesControl = checks.spf && (checks.spf.includesControl || checks.spf.includes_control);
  var spfOk = spfPresent && spfIncludesControl;
  
  items.push({
    label: 'SPF (Sender Authorization)',
    pass: spfOk,
    status: spfOk 
      ? 'Your SPF record is configured correctly and includes our central control.'
      : spfPresent
        ? 'SPF record found, but it does not include our central control yet.'
        : 'No SPF record found. Add the TXT record from Step 1.'
  });
  
  // DKIM check - API returns "s1.ok" and "s2.ok", not "s1.present" and "s1.points_to_control"
  var dkimS1Ok = checks.dkim && checks.dkim.s1 && checks.dkim.s1.ok;
  var dkimS2Ok = checks.dkim && checks.dkim.s2 && checks.dkim.s2.ok;
  var dkimOk = dkimS1Ok || dkimS2Ok;
  var dkimBothOk = dkimS1Ok && dkimS2Ok;
  
  items.push({
    label: 'DKIM (Email Signatures)',
    pass: dkimOk,
    status: dkimBothOk
      ? 'Both DKIM keys (s1 and s2) are configured correctly.'
      : dkimOk
        ? 'One DKIM key is configured. Consider adding both s1 and s2 for redundancy.'
        : 'No DKIM records found. Add the CNAME records from Step 1.'
  });
  
  // DMARC check - This one was correct
  var dmarcOk = checks.dmarc && checks.dmarc.present;
  items.push({
    label: 'DMARC (Email Policy)',
    pass: dmarcOk,
    status: dmarcOk
      ? 'Your DMARC policy is active. Policy: ' + (checks.dmarc.policy || 'none')
      : 'No DMARC record found. Add the TXT record from Step 1.'
  });
  
  var allPass = items.every(function(i) { return i.pass; });
  var passCount = items.filter(function(i) { return i.pass; }).length;
  
  var summaryHtml = '';
  if (allPass) {
    summaryHtml = '<div class="verify-summary all-pass">' +
      '<span class="verify-summary-icon">üéâ</span>' +
      '<div class="verify-summary-text">' +
        '<h4>Your domain is protected!</h4>' +
        '<p>All email authentication records are configured correctly.</p>' +
      '</div>' +
    '</div>';
  } else {
    summaryHtml = '<div class="verify-summary has-issues">' +
      '<span class="verify-summary-icon">‚ö†Ô∏è</span>' +
      '<div class="verify-summary-text">' +
        '<h4>' + passCount + ' of ' + items.length + ' checks passed</h4>' +
        '<p>Some records still need to be added. See details below.</p>' +
      '</div>' +
    '</div>';
  }
  
  var itemsHtml = items.map(function(item) {
    return '<div class="verify-item">' +
      '<div class="verify-icon ' + (item.pass ? 'pass' : 'fail') + '">' + (item.pass ? '‚úì' : '‚úó') + '</div>' +
      '<div class="verify-content">' +
        '<div class="verify-label">' + item.label + '</div>' +
        '<div class="verify-status ' + (item.pass ? 'pass' : 'fail') + '">' + item.status + '</div>' +
      '</div>' +
    '</div>';
  }).join('');
  
  container.innerHTML = summaryHtml + itemsHtml;
  show(container);
  
  logEl("#verify-log", data);
  show(detailsEl);
}

$("#btnVerify").addEventListener("click", async function(){
  var norm = normalizeForUI($("#verify-domain").value, $("#verify-notice"), null);
  if (!norm.ok){
    hide($("#verify-results"));
    hide($("#verify-details"));
    return;
  }
  
  $("#verify-results").innerHTML = '<div class="verify-summary has-issues"><span class="verify-summary-icon">‚è≥</span><div class="verify-summary-text"><h4>Checking your domain...</h4><p>This may take a few seconds while we query DNS servers.</p></div></div>';
  show($("#verify-results"));
  
  try{
    var j = await get(ROBOT_API + "/api/check-quick-codes?domain=" + encodeURIComponent(norm.apex || norm.value));
    renderVerifyResults(j);
  }catch(e){
    $("#verify-results").innerHTML = '<div class="verify-summary has-issues"><span class="verify-summary-icon">‚ùå</span><div class="verify-summary-text"><h4>Could not verify domain</h4><p>' + String(e).slice(0,150) + '</p></div></div>';
    show($("#verify-results"));
  }
});

/* ====== ADD DOMAIN + RECENT ====== */
async function refreshRecent(){
  var wrap = $("#recentWrap");
  if (!wrap) return;
  try{
    var j = await get(ROBOT_API + "/api/domains");
    var rows = (j && (j.domains || j.rows)) ? (j.domains || j.rows) : [];
    if (!rows.length){
      wrap.textContent = "No domains registered yet.";
      return;
    }
    wrap.innerHTML = rows.slice(0,10).map(function(r) {
      return '<div class="mono" style="margin-bottom:6px">'+(r.domain_name || "")+' <span class="muted">| '+(r.status || "")+(r.created_at ? " | "+r.created_at : "")+'</span></div>';
    }).join("");
  }catch(e){
    wrap.textContent = "Could not load domains.";
  }
}

$("#btnAdd").addEventListener("click", async function(){
  var noticeEl = $("#add-notice");
  var norm = normalizeForUI($("#add-domain").value, noticeEl, null);
  var email = ($("#add-email").value || "").trim();
  if (!email || !norm.ok){
    $("#add-log").textContent = "Please enter a valid email and domain name.";
    return;
  }
  try{
    if (noticeEl) hide(noticeEl);
    var j = await post(ROBOT_API + "/api/domains", {
      email: email,
      domain: norm.apex || norm.value
    });
    logEl("#add-log", j);
    refreshRecent();
  }catch(e){
    var msg = String(e);
    logEl("#add-log", "Error: " + msg);
    if (noticeEl){
      noticeEl.textContent = msg;
      show(noticeEl);
    }
  }
});

/* ====== CLOUDFLARE ====== */
$("#btnCfList").addEventListener("click", async function(){
  var token = ($("#cf-token").value || "").trim();
  if (!token){
    logEl("#cf-log","Please paste your Cloudflare API token first.");
    return;
  }
  try{
    var j = await post(ROBOT_API + "/api/cf/list-zones", { token: token });
    var sel = $("#cf-zones");
    sel.innerHTML = '<option value="">Select your domain</option>';
    (j.zones || []).forEach(function(z) {
      var o = document.createElement("option");
      o.value = z.id;
      o.textContent = z.name + " (" + (z.status || "") + ")";
      sel.appendChild(o);
    });
    logEl("#cf-log","Loaded " + (j.zones || []).length + " zones. Select your domain above.");
  }catch(e){
    logEl("#cf-log", String(e));
  }
});

$("#btnCfProtect").addEventListener("click", async function(){
  var token = ($("#cf-token").value || "").trim();
  var zone_id = $("#cf-zones").value;
  if (!token || !zone_id){
    logEl("#cf-log","Please load zones and select a domain first.");
    return;
  }
  try{
    var j = await post(ROBOT_API + "/api/cf/protect", { token: token, zone_id: zone_id });
    logEl("#cf-log", j);
    if (j.apex) {
      $("#verify-domain").value = j.apex;
    }
  }catch(e){
    logEl("#cf-log", String(e));
  }
});

/* ====== ROUTE 53 ====== */
async function r53ListZonesIfReady(){
  var access_key_id = ($("#r53-ak").value || "").trim();
  var secret_access_key = ($("#r53-sk").value || "").trim();
  if (!access_key_id || !secret_access_key) return;
  try{
    var j = await post(ROBOT_API + "/api/r53/list-zones", { access_key_id: access_key_id, secret_access_key: secret_access_key });
    var sel = $("#r53-zones");
    sel.innerHTML = '<option value="">Select your hosted zone</option>';
    (j.zones || []).forEach(function(z) {
      var o = document.createElement("option");
      o.value = z.id;
      o.textContent = z.name + " (" + z.id + ")";
      sel.appendChild(o);
    });
    logEl("#r53-log","Loaded " + (j.zones || []).length + " hosted zones.");
  }catch(e){
    logEl("#r53-log", String(e));
  }
}
$("#r53-ak").addEventListener("change", r53ListZonesIfReady);
$("#r53-sk").addEventListener("change", r53ListZonesIfReady);

$("#btnR53Protect").addEventListener("click", async function(){
  var access_key_id = ($("#r53-ak").value || "").trim();
  var secret_access_key = ($("#r53-sk").value || "").trim();
  var hosted_zone_id = $("#r53-zones").value;
  if (!access_key_id || !secret_access_key || !hosted_zone_id){
    logEl("#r53-log","Please enter credentials and select a hosted zone.");
    return;
  }
  try{
    var j = await post(ROBOT_API + "/api/r53/protect", { access_key_id: access_key_id, secret_access_key: secret_access_key, hosted_zone_id: hosted_zone_id });
    logEl("#r53-log", j);
    if (j.apex) {
      $("#verify-domain").value = j.apex;
    }
  }catch(e){
    logEl("#r53-log", String(e));
  }
});

/* ====== Bootstrap ====== */
initAuth();
</script>
</body>
</html>
